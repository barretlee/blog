<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><title>带你开发和调试 VS Code 源码 | 小胡子哥的个人网站</title><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,height=device-height,initial-scale=1,user-scalable=0"><meta name="author" content="https://plus.google.com/112634278852964994392?hl=zh-cn"><meta name="email" content="barret.china@gmail.com"><meta name="description" content="小胡子哥的个人网站"><meta property="og:type" content="article"><meta property="og:title" content="带你开发和调试 VS Code 源码 | 小胡子哥的个人网站"><meta property="og:url" content="https://www.barretlee.com/blog/2019/11/01/vscode-study-02-debugging/"><meta property="og:site_name" content="带你开发和调试 VS Code 源码"><meta property="og:description" content="小胡子哥的个人网站"><meta name="generator" content="https://hexo.io"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link href="https://img.alicdn.com/imgextra/i4/O1CN01LKRotr20M1ZGJkT3v_!!6000000006834-2-tps-1200-1200.png" rel="apple-touch-icon-precomposed"><link rel="shoticon" href="https://img.alicdn.com/imgextra/i3/O1CN01EVx62B1eyZLyJsJnY_!!6000000003940-2-tps-100-100.png" type="image/x-icon"><link rel="alternate" type="application/rss+xml" href="https://www.barretlee.com/rss2.xml" title="小胡子哥的个人网站"><link rel="prev" href="https://www.barretlee.com/blog/2019/11/07/resume-writing/" title="一个刚毕业的计算机相关专业学生，简历上有哪些经历会加分？"><link rel="next" href="https://www.barretlee.com/blog/2019/10/31/github-go-to-definition/" title="Github 的 Go to Definition 功能实现剖析"><link rel="start" href="https://www.barretlee.com/entry/" title="Blog Entry"><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/barretlee/blog@gh-pages/public/css/style-20230627-2.css"></head><body><div class="rainbow"></div><div class="container"><span class="local-search local-search-google local-search-plugin" style="display:none"><input type="search" placeholder="站内搜索" id="local-search-input" class="local-search-input-cls"> <i class="icon" aria-hidden="true" title="点击进入 Google 搜索">&#x2708;</i><div id="local-search-result" class="local-search-result-cls"></div></span><div class="article" itemscope itemtype="http://schema.org/Article"><div class="post"><div class="bread"><a href="/">小胡子哥的个人网站</a> » <a href="/entry/">博客</a> » <a class="category-link" href="/blog/categories/%E5%89%8D%E7%AB%AF%E6%9D%82%E8%B0%88/">前端杂谈</a>,<a class="category-link" href="/blog/categories/%E5%89%8D%E7%AB%AF%E6%9D%82%E8%B0%88/%E5%B7%A5%E5%85%B7/">工具</a></div><div class="post-title-wrapper"><h1 class="post-title" itemprop="name">带你开发和调试 VS Code 源码</h1><a href="/about/"><img style="max-width:120px" src="https://img.alicdn.com/imgextra/i1/O1CN01zmj6R326ehPa0NZO2_!!6000000007687-2-tps-1200-1200.png" alt="Barret李靖"></a></div><div class="post-info"><span>作者: <a href="/about/">Barret李靖</a></span> <span><time itemprop="timeCreated" aria-hidden="true">2019-11-01 17:43:00</time> <span class="aria-readonly">本文发布时间为2019年11月01日17时43分00秒</span> </span><span>分类: <a class="category-link" href="/blog/categories/%E5%89%8D%E7%AB%AF%E6%9D%82%E8%B0%88/">前端杂谈</a>,<a class="category-link" href="/blog/categories/%E5%89%8D%E7%AB%AF%E6%9D%82%E8%B0%88/%E5%B7%A5%E5%85%B7/">工具</a> </span><span tabindex="0" aria-hidden="true">标签: <a class="article-tag-none-link" href="/blog/tags/VSCode/" rel="tag">VSCode</a> </span><span class="aria-readonly">下面是正文内容</span> <span tabindex="0" aria-hidden="true">评论数: <a href="#comments" class="ds-thread-count hash-to-comments disqus-comment-count" data-thread-key="vscode-study-02-debugging" data-disqus-identifier="vscode-study-02-debugging"></a></span></div><div class="post-content" itemprop="articleBody"><p><a href="https://www.barretlee.com/blog/2019/10/23/vscode-study-01-start/">上文</a> 给大家介绍了如何在本地从源码启动 VS Code，笔者在更换电脑后重新安装依赖时又遇到了文中插曲里提到的问题，VS Code 依赖的很多资源都在 Github 上，而且有好几个模块都需要下载源码重新编译，安装依赖失败的概率还是略大的。</p><p>如果依赖的包构建失败，不用担心，等到启动的时候它会提示详细错误：</p><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">[<span class="number">92850</span>:<span class="number">1031</span>/<span class="number">221458.947969</span>:INFO:CONSOLE(<span class="number">17</span>)] </span><br><span class="line"><span class="comment">&quot;Error: The module &#x27;~/vscode/node_modules/spdlog/build/Release/spdlog.node&#x27;</span></span><br><span class="line">was compiled against <span class="keyword">a</span> different Node.js <span class="keyword">version</span> using</span><br><span class="line">NODE_MODULE_VERSION <span class="number">73</span>. This <span class="keyword">version</span> of Node.js requires</span><br><span class="line">NODE_MODULE_VERSION <span class="number">69</span>. Please <span class="keyword">try</span> re-compiling <span class="built_in">or</span> re-installing</span><br></pre></td></tr></table></figure><p>如上，是 <code>spdlog</code> 安装失败了，可以通过 <code>yarn add spdlog</code> 重新安装，如果一直报错，请注意 Node.js 的版本，我使用的是 <code>v10.6.0</code>，编译的是 tag 为 <code>1.39.2</code> 的 VS Code 源码，没遇到问题。</p><blockquote><p>测试过几次，当我切换 VS Code 的版本（git tag）时，似乎 spdlog 和 vscode-sqlite3 这两个包的安装总是存在问题，按照上述方式重新安装和编译下就行了。</p></blockquote><h3 id="Main-和-Renderer"><a href="#Main-和-Renderer" class="headerlink" title="Main 和 Renderer"></a>Main 和 Renderer</h3><p>倘若你之前没有 Electron 的开发经验，这个段落不容错过。</p><blockquote><p>如果你可以建一个网站，你就可以建一个桌面应用程序。 Electron 是一个使用 JavaScript, HTML 和 CSS 等 Web 技术创建原生程序的框架，它负责比较难搞的部分，你只需把精力放在你的应用的核心上即可。</p></blockquote><p>Electron 是个什么东西？官方对它的定义是：“使用 JavaScript, HTML 和 CSS 构建跨平台的桌面应用”。</p><p><img src="https://raw.githubusercontent.com/barretlee/blog/gh-pages/blogimgs/2019/11/01/electreon-structure.png" alt="Electron Structure"></p><p>打开 Electron 的 <a  target="_blank" href="https://electronjs.org/docs">文档</a>，从文档目录中，你大致就能够知道 Electron 可以做什么。Electron 有两大模块，<code>Main Process</code> 和 <code>Renderer Process</code>，暴露出来的上层 API 并不多，我数了一下，约摸 30 个。搞懂这 30 个 API 可能不是什么难事，但是在搞清楚 API 之前，我们需要先知道这两大模块之间是如何交互和协作的，以帮助我们更好地理解。</p><p>打开官方的 quick start demo：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/electron/electron-quick-start</span><br><span class="line"><span class="comment"># 进入仓库</span></span><br><span class="line">$ <span class="built_in">cd</span> electron-quick-start</span><br><span class="line"><span class="comment"># 安装依赖库</span></span><br><span class="line">$ npm install</span><br><span class="line"><span class="comment"># 运行应用</span></span><br><span class="line">$ npm start</span><br></pre></td></tr></table></figure><p>你会看到两个核心文件，一个是 <code>main.js</code>，另外一个是 <code>index.html</code>，你完全可以这么理解：前者跑的是 Main Process，它的执行环境是一个 <code>Node</code> 环境；后者跑的是 Renderer Process，它的执行环境是一个 <code>Chromium + Node</code> 环境，也就是说，我们写的 <code>index.html</code> 中可以去调用 Node.js 的模块，这也是 Electron 与普通浏览器的主要差别。</p><p>Main 进程中可以通过 <code>BrowserWindow</code> 实例化多个 Renderer 进程，且每个 Renderer 进程相关独立，在复杂的项目中会涉及到了很多通信问题，比如 Main-Renderer 通讯，Renderer-Main 通讯，Renderer-Renderer 通讯，VS Code 中就有很多这类问题的优秀解决方案，不过不在我们今天的讨论范畴中。</p><p>Main 和 Renderer 之间的关系，可以用这种图来形容（<a  target="_blank" href="http://jlord.us/essential-electron/">图片来源</a>）：</p><p><img src="https://raw.githubusercontent.com/barretlee/blog/gh-pages/blogimgs/2019/11/01/main-and-renderer.png" alt="Main and Renderer"></p><p>对于 Electron，先了解这么多知识，如果你期望了解更多，可以移步 <a  target="_blank" href="https://electronjs.org/docs">Electron 官方文档</a>。</p><h3 id="初识-VS-Code"><a href="#初识-VS-Code" class="headerlink" title="初识 VS Code"></a>初识 VS Code</h3><p>很多同学对 VS Code 已经熟悉得不能再熟悉了，谈不上初识，不过我们这里说的“初识”是针对它的架构和源码，相信对大多数人来说，它依然是陌生的。</p><p>先看看项目的整体目录结果，过滤了几个次要项：</p><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── azure-pipelines<span class="selector-class">.yml</span></span><br><span class="line">├── build/</span><br><span class="line">├── extensions/</span><br><span class="line">├── gulpfile<span class="selector-class">.js</span></span><br><span class="line">├── out/</span><br><span class="line">├── package<span class="selector-class">.json</span></span><br><span class="line">├── product<span class="selector-class">.json</span></span><br><span class="line">├── resources/</span><br><span class="line">├── scripts/</span><br><span class="line">├── <span class="attribute">src</span>/</span><br><span class="line">│   ├── <span class="selector-tag">main</span><span class="selector-class">.js</span></span><br><span class="line">│   └── vs</span><br><span class="line">│       ├── base/</span><br><span class="line">│       ├── code/</span><br><span class="line">│            ├── browser/</span><br><span class="line">│                 ├── workbench<span class="selector-class">.ts</span></span><br><span class="line">│                 └── workbench/workbench<span class="selector-class">.html</span></span><br><span class="line">│            ├── electron-browser/</span><br><span class="line">│                 ├── workbench<span class="selector-class">.js</span></span><br><span class="line">│                 └── workbench/workbench<span class="selector-class">.html</span></span><br><span class="line">│            └── electron-main/</span><br><span class="line">│                 ├── <span class="selector-tag">main</span><span class="selector-class">.ts</span></span><br><span class="line">│                 └── window<span class="selector-class">.ts</span></span><br><span class="line">│       ├── editor/</span><br><span class="line">│       ├── platform/</span><br><span class="line">│       ├── server/</span><br><span class="line">│       └── workbench/</span><br><span class="line">└── test/</span><br></pre></td></tr></table></figure><p>上面这一坨看起来有点多，不过捋清楚了，也就好理解了，下面我们就一个一个地解释下：</p><ul><li><code>azure-pipelines.yml</code>，看名字就知道是啥意思，它是一个 CI&#x2F;CD 的配置，自动测试、构建、打包</li><li><code>build/</code>，这里面放的是 VS Code 项目的构建工具，相对来说还是比较复杂的，主要是因为它顾及了 Linux&#x2F;Mac&#x2F;Windows 三个平台</li><li><code>extensions/</code>，VS Code 的内置模块，包含各种语言高亮的 LSP 相关模块</li><li><code>gulpfile.js</code>，构建脚本，暂时不用细看，可以关注 <code>package.json</code> 的 scripts，里面放着一些程序的快捷启动方式，而且针对内存溢出做了防御，如 <code>--max_old_space_size=4095</code></li><li><code>out/</code>，构建的结果都放在这个目录下</li><li><code>package.json</code>，需要着重看看 <code>main</code> 和 <code>scripts</code> 两个字段</li><li><code>product.json</code>，如果你想根据 VS Code 进行二次开发，建立自己的品牌，建议搞懂这个文件，因为你需要修改它</li><li><code>resource/</code>，打包构建生成安装包（exe&#x2F;dmg&#x2F;deb 等）的时候需要依赖的额外资源</li><li><code>scripts/</code>，开发过程各种会用到的脚本，用的比较多的可能是 <code>./scripts/code.sh</code></li><li><code>test/</code>，放的是各种自动化、冒烟、UI 测试脚本，这里值得学习和研究下</li><li><code>src/</code>，核心源码，入口是 <code>main.js</code><ul><li>Main Process 的实际调用路径是 <code>main.js -&gt; vs/code/electron-main/main.ts -&gt; vs/code/electron-main/window.ts</code>，在 <code>window.ts</code> 启动了一个 <code>BrowserWindow</code> 加载了 <code>vs/code/electron-browser/workbench/workbench.html</code></li><li>Renderer Process 的实际路径是 <code>vs/code/electron-browser/workbench/workbench.html -&gt; vs/code/electron-browser/workbench/workbench.js</code>，核心逻辑在 <code>workbench.js</code> 中</li><li>而 src 下还有一个核心目录 <code>browser</code>，它是 Web 版本的启动入口</li></ul></li></ul><p>VS Code 的复杂度，有好几块，分别是构建、IoC 机制、RPC 设计、ExtensionHost 环境等，再加上 Electron 本身的各种坑，后续我们可以一一进行探讨。</p><h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><p>在玩转 VS Code 架构设计之前，我们需要先搞清楚代码的大致执行流程，还要学会在遇到问题时调试它的代码，光靠通扫几遍源码你是很难完全理解的。</p><p>VS Code 的使用文档写的非常棒，但是架构和设计文档只能从代码中自己探索，这是可以理解的，VS Code 目前还在高速发展中，内部架构设计调整也十分频繁，而且他们可能倡导的是“代码即文档”，通过一些规范化约束来帮助开发者理解架构设计。</p><p>不过没关系，既然开源了，就自己研究好了。下面我们先看看如何对 VS Code 的各块代码进行有效调试。</p><p>说到调试，有几个基础知识不得不提一提，不解释清楚，很多同学是无法理解为什么在工具上点几下就会进入调试的。</p><h4 id="Node-js-调试"><a href="#Node-js-调试" class="headerlink" title="Node.js 调试"></a>Node.js 调试</h4><p>Electron 的 <code>Main Process</code> 本质就是一个 Node.js 进程，你可以执行如下命令看看 Electron 的 bin 文件内容：</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">npm install -g electron</span><br><span class="line">head -n <span class="number">5</span> <span class="constructor">$(<span class="params">where</span> <span class="params">electron</span> | <span class="params">head</span> -<span class="params">n</span> 1)</span></span><br></pre></td></tr></table></figure><p>打印出来的结果是：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> electron = <span class="built_in">require</span>(<span class="string">&#x27;./&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> proc = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)</span><br></pre></td></tr></table></figure><p>对 Node.js 的调试，可以看看我四年前写的 <a href="https://www.barretlee.com/blog/2015/10/07/debug-nodejs-in-command-line/">《NodeJS 的代码调试和性能调优》</a>，时间有点久了，不过调试原理并没有啥变化。</p><blockquote><p>简单来说，就是启动 Node 时增加了一个 <code>--debug-brk</code> 入参（新版是 <code>--inspect-brk</code>），开启一个可供外部断点调试的端口，然后在外部使用各类工具连接端口，发送指令进行调试。</p></blockquote><h4 id="Chrome-调试"><a href="#Chrome-调试" class="headerlink" title="Chrome 调试"></a>Chrome 调试</h4><p>Chromium 在启动的时候有一个可选参数 <code>--remote-debugging-port</code>, 加上这个参数以后，它会开启远程调试模式，如：</p><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/Applications/</span>Google\ Chrome.app<span class="regexp">/Contents/</span>MacOS/Google\ Chrome -remote-debugging-port=<span class="number">9222</span></span><br></pre></td></tr></table></figure><blockquote><p>如果你的 Chrome 已经启动，上面的命令不会有效果，可以考虑下载一个 Google Chrome Canary</p></blockquote><p>通过 <code>http://127.0.0.1:9222/json</code> 可以看到当前 Chrome 打开了哪些页面，并且它还会把 DevTools 的 ws 地址也展示出来：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;devtoolsFrontendUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/devtools/inspector.html?ws=127.0.0.1:9222/devtools/page/3CFC...&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3CFC338A39A4CF1F31F0CB499D94C071&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;新标签页&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;page&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chrome://newtab/&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;webSocketDebuggerUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ws://127.0.0.1:9222/devtools/page/3CFC...&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们来做一个小小的实验，上面打开了一个 Chrome，并且展示了一个空标签页，我们尝试使用 websocket 连接它，然后控制它：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> wsUrl = <span class="string">&quot;ws://127.0.0.1:9222/devtools/page/3CFC...&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(wsUrl);</span><br><span class="line">ws.<span class="property">onmessage</span> = <span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">ws.<span class="property">onclose</span> = <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;closed&#x27;</span>);</span><br><span class="line">ws.<span class="property">onopen</span> = <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;opened&#x27;</span>);</span><br></pre></td></tr></table></figure><p>随便找个浏览器的控制台执行这段脚本，会看到打印出来了 <code>opened</code>，然后我们尝试让这个 “新标签页” 跳转到我的博客首页，发送几句命令：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 开启网络功能</span></span><br><span class="line">ws.<span class="title function_">send</span>(<span class="string">`&#123;</span></span><br><span class="line"><span class="string">  &quot;id&quot;:1,</span></span><br><span class="line"><span class="string">  &quot;method&quot;:&quot;Network.enable&quot;</span></span><br><span class="line"><span class="string">&#125;`</span>)；</span><br><span class="line"><span class="comment">// 跳转页面</span></span><br><span class="line">ws.<span class="title function_">send</span>(<span class="string">`&#123;</span></span><br><span class="line"><span class="string">  &quot;id&quot;: 1,</span></span><br><span class="line"><span class="string">  &quot;method&quot;: &quot;Page.navigate&quot;,</span></span><br><span class="line"><span class="string">  &quot;params&quot;: &#123; &quot;url&quot;: &quot;https://www.barretlee.com&quot; &#125;</span></span><br><span class="line"><span class="string">&#125;`</span>);</span><br></pre></td></tr></table></figure><p>你会看到，通过命令行打开的 Chrome 的默认页已经自动跳转到了 <code>https://www.barretlee.com</code>，看到这里你应该已经可以理解了，所谓的调试，其实就是通过连接 Chrome 内部的 DevTools 工具，然后利用 RPC 的方式进行通讯，事实上，这里用到的是 <a  target="_blank" href="https://chromedevtools.github.io/devtools-protocol/">Remote Debugging Protocol</a> 进行的通讯。</p><blockquote><p>大名鼎鼎的 <a  target="_blank" href="https://github.com/GoogleChrome/puppeteer">Puppeteer</a> 就是基于这层协议做的封装。</p></blockquote><p>好了，为了让你理解 VS Code 的调试原理，已经做了很多铺垫了，事实上，在 VS Code 上进行调试的操作是十分简单的，下面就带着你一起演示下。</p><h3 id="软件调试"><a href="#软件调试" class="headerlink" title="软件调试"></a>软件调试</h3><p>使用 VS Code 打开 VS Code 的源码，点开左侧 sidebar 的 Debug Tab，你会看到调试区域存在很多个调试选项：</p><p><img src="https://raw.githubusercontent.com/barretlee/blog/gh-pages/blogimgs/2019/11/01/vscode-debug-panel.png" alt="VSCode Debug Panel"></p><p>这里的所有调试配置，都对应着项目中 <code>.vscode/launch.json</code> 的内容，我之前写过一篇关于 <code>launch.json</code> 的 <a href="https://www.barretlee.com/blog/2019/03/18/debugging-in-vscode-tutorial/">文章</a>，在这里我们又有机会用到了。</p><p>软件的调试分为两个部分，一个是 Main 进程的调试，一个是 Renderer 进程的调试。</p><blockquote><p>开始调试之前，请先把 VS Code Dev 的监听模式打开，项目目录下执行 <code>yarn watch</code></p></blockquote><h4 id="Main-进程调试"><a href="#Main-进程调试" class="headerlink" title="Main 进程调试"></a>Main 进程调试</h4><p>先进入到一个 Main 进程会执行到的代码区域，打一个断点，如 <code>vs/code/electron-main/main.ts:404:0</code>，然后选择 <code>launch.json</code> 中的 <code>Launch VS Code (Main Process)</code> 配置：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Launch VS Code (Main Process)&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;runtimeExecutable&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/scripts/code.sh&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;windows&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;runtimeExecutable&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/scripts/code.bat&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;runtimeArgs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;--no-cached-data&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outFiles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;$&#123;workspaceFolder&#125;/out/**/*.js&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>启动的默认端口是 <code>5875</code>，点击开始调试按钮，或者按下快捷键 <code>F5</code>，便会进入调试模块，在 VS Code 上也有体现：</p><p><img src="https://raw.githubusercontent.com/barretlee/blog/gh-pages/blogimgs/2019/11/01/vscode-node-debugging.png" alt="VSCode Node Debugging"></p><p>可以看到我们打点的位置也已经亮了起来，阻塞了 VS Code Dev 的启动：</p><p><img src="https://raw.githubusercontent.com/barretlee/blog/gh-pages/blogimgs/2019/11/01/vscode-node-deubgging-demo.png" alt="VSCode Node Debugging Demo"></p><p>好了，现在可以开始你的 Main 进程代码探索之旅了。</p><blockquote><p>需要注意，在调试 Main Process 的时候，不要把断点打到 Renderer 进程里去了，否则你永远也进不了断点；也不要打到 Main Process 不会执行的代码区域，这就要求你对 VS Code 的目录结构有一定的了解了，可以参考“初识 VS Code”章节的介绍</p></blockquote><p>另外，再给你留了一道作业题：</p><blockquote><p>尝试使用其他工具，如 node-inspector 或者 Webstorm 调试 Main 进程。</p></blockquote><h4 id="Renderer-进程的调试"><a href="#Renderer-进程的调试" class="headerlink" title="Renderer 进程的调试"></a>Renderer 进程的调试</h4><p>Renderer 进程的调试，本质就是通过外部工具连接 Electron 中 Chromium 打开的一个 DevTools Server，使用 WebSocket 建立连接，然后发送和接受各种指令。</p><p>选择 <code>launch.json</code> 中的 <code>Launch VS Code</code>，它的内容是：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chrome&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Launch VS Code&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;windows&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;runtimeExecutable&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/scripts/code.bat&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;osx&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;runtimeExecutable&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/scripts/code.sh&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;linux&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;runtimeExecutable&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/scripts/code.sh&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timeout&quot;</span><span class="punctuation">:</span> <span class="number">20000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;VSCODE_EXTHOST_WILL_SEND_SOCKET&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;breakOnLoad&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;urlFilter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*workbench.html*&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;runtimeArgs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;--inspect=5875&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;--no-cached-data&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;webRoot&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>同样，开启调试后，找个 Renderer 进程会执行到的代码块进行断点，如 <code>vs/code/workbench/workbench.desktop.main.ts</code>，如果你的 VS Code Dev 已经启动了，可以在 VS Code Dev 的界面中按下 <code>cmd+r</code>，它会自动刷新 Renderer 进程（刷新页面），重新进入你的断点：</p><p><img src="https://raw.githubusercontent.com/barretlee/blog/gh-pages/blogimgs/2019/11/01/vscode-chrome-deubgging.png" alt="VSCode Chrome Debugging"></p><p>怎么样，看到这里，是不是对开发 VS Code 的源码已经有信心了。</p><blockquote><p>需要注意的是，如果你是通过 <code>./script/code.sh</code> 在控制台手动启动的 VS Code Dev，<code>launch.json</code> 中的 <code>Attach to VS Code</code> 是无效的，因为在启动的时候，不会默认添加 –remote-debugging-port 入参</p></blockquote><h3 id="构建脚本调试"><a href="#构建脚本调试" class="headerlink" title="构建脚本调试"></a>构建脚本调试</h3><p>知道了如何对软件本身的代码进行调试，大部分情况下已经够用了，但是如果你在启动 VS Code 的时候失败了，报了个错，或者当你打包 VS Code 的时候，抛出个异常，需要怎么排查问题呢？</p><p>这里，我们可以了解下构建脚本的调试，虽说构建脚本我们可以随时写一句 <code>console.log</code> 打印日志，但是 VS Code 的 <code>build</code> 脚本是非常多，而且每一次的构建都特别漫长，还是更加推荐你使用它提供的构建脚本调试能力进行 Debug，在 <code>launch.json</code> 中有一个 <code>Gulp Build</code> 配置：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Gulp Build&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/node_modules/gulp/bin/gulp.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;stopOnEntry&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;hygiene&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>通过这个配置启动 gulp，这样就可以对构建脚本进行断点了，由于配置中加了 <code>stopOnEntry</code>，当进入调试的时候，第一行就会断住：</p><p><img src="https://raw.githubusercontent.com/barretlee/blog/gh-pages/blogimgs/2019/11/01/debug-grulp.png" alt="VSCode Gulp Debugging"></p><p>你也可以去掉这个参数，不过需要你在执行 gulp 之前在程序中提前断一个点：</p><p><img src="https://raw.githubusercontent.com/barretlee/blog/gh-pages/blogimgs/2019/11/01/debug-gulp-file.png" alt="VSCode Gulp Debugging"></p><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>好了，VS Code 源码的调试教程就写到这里，希望你读完这篇文章以后，可以自己动手去尝试，很多比较细节的点我没有写全面，所以实践过程中你可能还会遇到一些坑，当你躺平了这些坑，相信你就可以完全理解这些调试的基本原理了。</p><p>后续将带着大家看一看 VS Code 的整体执行链路，其实上次我已经写过一篇类似的 <a href="https://www.barretlee.com/blog/2019/08/03/vscode-source-code-reading-notes/">文章</a>了，行文比较粗糙，下次将带着大家一边调试一边看代码和执行链路。</p></div></div><div class="old-article-warning">本文在 <b>2087</b> 天之前发表，技术更替飞快，文中部分内容可能已经过时，如有疑问，请联系作者 <a href="/about">Barret李靖</a>。</div><div class="copyright" itemscope itemtype="http://schema.org/ProfilePage" tabindex="0" aria-hidden="true"><ul><li>作者: <a href="/about/" itemprop="name">Barret李靖</a></li><li>文章分类: <a class="category-link" href="/blog/categories/%E5%89%8D%E7%AB%AF%E6%9D%82%E8%B0%88/">前端杂谈</a>,<a class="category-link" href="/blog/categories/%E5%89%8D%E7%AB%AF%E6%9D%82%E8%B0%88/%E5%B7%A5%E5%85%B7/">工具</a></li><li>文章标签: <a class="article-tag-none-link" href="/blog/tags/VSCode/" rel="tag">VSCode</a></li><li>发表日期: 2019-11-01 17:43:00</li><li>最后编辑时间: 2025-07-19 11:01:03</li><li>本文 Markdown 地址: <a target="_
			" href="https://github.com/barretlee/blog/tree/master/blog/src/_posts/2019-11-01-vscode-study-02-debugging.md">带你开发和调试 VS Code 源码</a></li><li>版权声明：<a  target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">CC BY-NC-ND 3.0</a></li><li>Feed 订阅: <a href="/rss2.xml"><i class="icon">&#x25c8;</i></a><div style="opacity:.3;text-align:right;margin:5px -5px -10px 0;float:right;font-size:12px">编辑本文：<a  target="_blank" href="https://github.com/barretlee/blog/edit/master/blog/src/_posts/2019-11-01-vscode-study-02-debugging.md" target="_blank" aria-hidden="true"><i class="icon">&#xe622;</i></a>； 新建文章：<a  target="_blank" href="https://github.com/barretlee/blog/new/master/blog/src/_posts" target="_blank" aria-hidden="true"><i class="icon">&#xe616;</i></a></div></li></ul><a href="/about/"><img style="max-width:120px" src="https://img.alicdn.com/imgextra/i3/O1CN01tDYnfz23AWT1ag79p_!!6000000007215-2-tps-1200-1200.png"></a></div><em class="arrow-expend" tabindex="0" aria-hidden="0" aria-label="点击展开网页导航" aria-selected="true" aria-lable="网页导航" aria-expanded="false" id="i1">▾<ul role="group" aria-labelledby="i1" aria-expanded="false"><li><a href="/entry/">博客</a></li><li><a href="/message/">留言</a></li><li><a href="/demo/">实验室</a></li><li><a href="/friends/">友情链接</a></li></ul></em></div><div class="post-relative"><div class="page-relative"><a href="/blog/2019/11/07/resume-writing/" class="post-prev"><i class="icon" tabindex="0" aria-hidden="true">&#x261c;</i> <span class="aria-readonly">上一篇文章</span> <b>一个刚毕业的计算机相关专业学生，简历上有哪些经历会加分？</b> </a><a href="/blog/2019/10/31/github-go-to-definition/" class="post-next"><span class="aria-readonly">下一篇文章</span> <b>Github 的 Go to Definition 功能实现剖析</b> <i class="icon" tabindex="0" aria-hidden="true">&#xe602;</i></a></div><div class="page-relative-fixed" tabindex="0" aria-hidden="true"><a href="/blog/2019/11/07/resume-writing/" class="prev" title="一个刚毕业的计算机相关专业学生，简历上有哪些经历会加分？"><i class="icon">&#xe600;</i> <b>一个刚毕业的计算机相关专业学生，简历上有哪些经历会加分？</b> </a><a href="/blog/2019/10/31/github-go-to-definition/" class="next" title="Github 的 Go to Definition 功能实现剖析"><i class="icon">&#x261e;</i> <b>Github 的 Go to Definition 功能实现剖析</b></a></div></div></div><div class="sidebar" tabindex="0" aria-hidden="true"><div class="func-btns func-btns-up"><span class="func-item"><i class="func-nav icon">&#xe618;<span>目录</span></i><div><i class="left-arrow"></i><i class="left-arrow-clone"></i> <a href="javascript:void(0);" onclick="return!1">显示目录</a></div></span><span class="func-item"><i class="func-font icon">&#xe604;<span>夜间</span></i><div class="font-choose-box"><i class="left-arrow"></i><i class="left-arrow-clone"></i><div class="font-choose bg-choose"><a href="javascript:void(0)" onclick="return!1" class="bg-type bg-type-sun font-type-song"><i class="icon">&#xe61a;</i></a> <a href="javascript:void(0)" onclick="return!1" class="bg-type bg-type-moon font-type-hei"><i class="icon">&#xe619;</i></a></div></div></span><span class="func-item"><i class="func-about icon">&#x263b;<span>关于</span></i><div><i class="left-arrow"></i><i class="left-arrow-clone"></i><p><a href="/about/" class="func-about-link" target="_blank">关于作者</a></p><div id="followMeOnWeibo"></div></div></span></div><div class="func-btns"><span class="func-item"><a href="/friends/" target="_blank"><i class="func-rss icon">&#xe601;<span>链接</span></i></a><div><i class="left-arrow"></i><i class="left-arrow-clone"></i> <a href="/friends/" target="_blank">友情链接</a></div></span><span class="func-item"><a href="/rss2.xml" target="_blank"><i class="func-rss icon">&#x25c8;<span>订阅</span></i></a><div><i class="left-arrow"></i><i class="left-arrow-clone"></i><a href="/rss2.xml" target="_blank">订阅我吧！</a></div></span></div></div><div class="single-page-footer"><div class="footer"><div class="footer-wraper"><div class="footer-content"><div class="footer-nav"><a href="javascript: void(0);" class="ds-thread-count disqus-comment-count" data-thread-key="vscode-study-02-debugging" data-disqus-identifier="vscode-study-02-debugging" tabindex="0" aria-hidden="true">评论内容</a> <a href="javascript: void(0);" id="comments">相关文章</a> <a href="/friends/" tabindex="0" aria-hidden="true" style="display:none">友情链接</a></div><div class="nav-detail"><div tabindex="0"><div id="gitalk" sid="vscode-study-02-debugging"></div><script charset="utf-8" type="text/javascript" src="https://fastly.jsdelivr.net/gh/barretlee/blog@gh-pages/public/js/gitalk.js"></script><script type="text/javascript">var postContent=document.querySelectorAll(".post-content>p");postContent&&postContent.length&&(postContent=(postContent=postContent.item(0).textContent+(postContent.item(1)&&postContent.item(1).textContent||"")).length>140?postContent.slice(0,140)+"...":postContent);var gitalk=new Gitalk({clientID:"50a1b3aa7854b01a1c85",clientSecret:"226ac154f80a6aea0985da874126b35795f22eed",language:"zh-CN",perPage:100,createIssueManually:!1,repo:"blog",owner:"barretlee",admin:["barretlee"],id:"vscode-study-02-debugging",body:"原文地址："+location.href+"\n\n文摘："+postContent,distractionFreeMode:!1});window.addEventListener("load",(function(){gitalk.render("gitalk")}));var commentTimer=setInterval(()=>{var t=document.querySelector(".gt-link-counts"),e=document.querySelector(".hash-to-comments");t&&e&&(e.textContent=t.textContent,clearInterval(commentTimer))},500);setTimeout(()=>{clearInterval(commentTimer)},6e4)</script></div><div style="display:block"><div class="relative-wrapper"><div class="relative-article"><ul><li><span><font aria-hidden="true">2019-11-15 »</font> </span><a href="/blog/2019/11/15/vscode-study-03-debug-protocol/">解密 VS Code 断点调试的原理</a> <span class="aria-readonly">发表时间为2019年11月15日</span><div class="relative-box"><a href="/blog/2019/11/15/vscode-study-03-debug-protocol/" class="relative-img-wrapper"><img src="https://raw.githubusercontent.com/barretlee/blog/gh-pages/blogimgs/2019/11/15/dap.png" style="width:100%" loading="lazy" data-original="/../blogimgs/2019/11/15/dap.png"></a><span class="aria-readonly">文章概要 </span>VS Code 相关系列的文章，近段时间已经写过三篇（启动过程，安装，开发和调试）了，后续还会在研究和学习的过程中持续输出，希望对感兴趣的读者带来一些帮助。我的文章风格一般都是持续挖掘底层原理，打破砂锅问到底，一直挖掘到大众能都理解的深度才...</div></li><li><span><font aria-hidden="true">2019-10-28 »</font> </span><a href="/blog/2019/10/28/commit-convention/">Git 约定式提交规范实践</a> <span class="aria-readonly">发表时间为2019年10月28日</span><div class="relative-box"><span class="aria-readonly">文章概要 </span>约定式提交规范 提供了一个轻量级的提交历史编写规则，它的内容十分简单：&lt;type&gt;[optional scope]: &lt;description&gt;[optional body][optional footer(s)]举...</div></li><li><span><font aria-hidden="true">2019-10-23 »</font> </span><a href="/blog/2019/10/23/vscode-study-01-start/">让 VSCode 在本地 Run 起来</a> <span class="aria-readonly">发表时间为2019年10月23日</span><div class="relative-box"><a href="/blog/2019/10/23/vscode-study-01-start/" class="relative-img-wrapper"><img src="https://raw.githubusercontent.com/barretlee/blog/gh-pages/blogimgs/2019/10/23/vscode-snapshot.png" style="width:100%" loading="lazy" data-original="/../blogimgs/2019/10/23/vscode-snapshot.png"></a><span class="aria-readonly">文章概要 </span>Visual Studio Code 是微软推出的一款轻量级编辑器，与它一起在市场争锋的相似软件还有 Atom 和 Sublime Text，面世第二年的它只占据 7% 左右的市场，后来在短短三年时间雄踞了半壁江山，不可谓不哇塞。发育如此强...</div></li><li><span><font aria-hidden="true">2019-08-03 »</font> </span><a href="/blog/2019/08/03/vscode-source-code-reading-notes/">VSCode 是怎么运行起来的？</a> <span class="aria-readonly">发表时间为2019年08月03日</span><div class="relative-box"><span class="aria-readonly">文章概要 </span>之前有基于 VSCode 做二次开发的经验，约摸全投入持续了 5 个多月，开发了一个 Editor，算是超级魔改吧，虽然保留了 VSCode 的样子，但是整个板块都有比较大的调整，新增了 Webview 预览面板、Devtool 调试工具、...</div></li></ul></div></div><div class="relative-to-comment" tabindex="0" aria-hidden="true"><span>留下评论</span></div></div><div class="friends-box"><ul><li><a  target="_blank" href="http://hustskyking.cnblogs.com" target="_blank">旧博客</a> <font aria-hidden="true">»</font> <span>我的旧博客（博客园荣誉博客）</span></li><li><a  target="_blank" href="http://www.zhangmengxue.com" target="_blank">大额</a> <font aria-hidden="true">»</font> <span>大额大额哼歌等日落</span></li><li><a  target="_blank" href="http://www.zhangxinxu.com" target="_blank">张鑫旭</a> <font aria-hidden="true">»</font> <span>原来大学我俩一个团队的~</span></li><li><a  target="_blank" href="http://web-tinker.com" target="_blank">次碳酸钴</a> <font aria-hidden="true">»</font> <span>深度交流的一个好朋友</span></li><li><a  target="_blank" href="http://imququ.com" target="_blank">屈屈</a> <font aria-hidden="true">»</font> <span>蛐蛐同学</span></li><li><a  target="_blank" href="http://www.ruanyifeng.com" target="_blank">阮一峰</a> <font aria-hidden="true">»</font> <span>阮老师</span></li><li><a href="/friends/">更多列表 <font aria-hidden="true">»</font></a></li></ul></div></div><div class="website-info" aria-hidden="true"><a class="page_editor" href="/admin/#/posts/cmd9nvph800xnqk9bd76b7y3k" target="_blank">🙈</a> <span>&copy;2013-2025 <small><a  target="_blank" href="https://www.miit.gov.cn/" about="_blank">湘ICP备14007107号-1</a></small></span> 本站由 <a href="/">Barret李靖</a> 纯手工打造 | <a href="/about#contact">联系方式</a> <a  target="_blank" href="https://union.zhaodao.ai/#random" title="随机跳转到一个有意思的网站" target="_blank" class="zhidao_ai"><img src="https://img.alicdn.com/imgextra/i2/O1CN01VjiZUL1r0eXge4taM_!!6000000005569-55-tps-300-300.svg" width="20" height="20"></a></div></div></div></div></div><div class="tools-wrapper" tabindex="0" aria-hidden="true"><a class="gotop icon" href="#" title="回到顶部">&#x2191;</a><a class="hash-to-comments icon" title="我要评论">&#x2121;</a></div><div class="fixerr" tabindex="0" aria-hidden="true">纠错模式</div></body><script src="https://fastly.jsdelivr.net/gh/barretlee/blog@gh-pages/public/js/jquery.js"></script><script src="https://fastly.jsdelivr.net/gh/barretlee/blog@gh-pages/public/js/main.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-67248043-3"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-67248043-3")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?3524fff9629f2c80f8ea5daa13e67003";var t=document.getElementsByTagName("script")[0];t.async=!0,t.parentNode.insertBefore(e,t)}()</script><script>window.onerror=function(o){window.console&&window.console.log&&window.console.log(o);try{$("#loadLayer").remove()}catch(o){}return!0}</script></html>