var weiboName="@Barret李靖";if(window.location.hostname==="barretlee.com"){window.location.href=location.url.replace("barretlee.com","www.barretlee.com")}var params={};~function(){var e=location.href.split("?")[1];e=e&&e.split("&")||[];for(var t=0;t<e.length;t++){var i=e[t].split("=");if(i&&i[0]){params[i[0]]=i[1]}}}();if(params["share"]){$("html").addClass("shareMode");$('<p style="color:#555;text-align:right; font-size:14px;" id="authorAppend">文 / Barret李靖</p>').prependTo(".post-content")}else{$("html").removeClass("shareMode");$("#authorAppend").remove()}$(function(){var e="";var t=navigator.appVersion.match(/MSIE (\d+)/i);t=t&&t[1];if(t&&t<10){e="更好的阅读体验，请使用最新版的 Chrome 浏览器。<a href='javascript:void(0);' class='close'>关闭</a>"}if(e&&!$("html").attr("loaded")){$(".rainbow").addClass("notice").html(e).hide().fadeIn()}});function notify(i){if(!("Notification"in window)){}else if(Notification.permission==="granted"){var e=new Notification(i.title,i)}else if(Notification.permission!=="denied"){Notification.requestPermission(function(e){if(e==="granted"){var t=new Notification(i.title,i)}})}if(e){e.onclick=function(){if(i.url){window.open(i.url)}else{$(".chatroom-fold .chatroom-info").trigger("click");window.focus()}e.close()}}}(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof exports==="object"){e(require("jquery"))}else{e(jQuery)}})(function(h){var t=/\+/g;function u(e){return g.raw?e:encodeURIComponent(e)}function p(e){return g.raw?e:decodeURIComponent(e)}function m(e){return u(g.json?JSON.stringify(e):String(e))}function o(e){if(e.indexOf('"')===0){e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{e=decodeURIComponent(e.replace(t," "));return g.json?JSON.parse(e):e}catch(e){}}function w(e,t){var i=g.raw?e:o(e);return h.isFunction(t)?t(i):i}var g=h.cookie=function(e,t,i){if(t!==undefined&&!h.isFunction(t)){i=h.extend({},g.defaults,i);if(typeof i.expires==="number"){var o=i.expires,n=i.expires=new Date;n.setTime(+n+o*864e5)}return document.cookie=[u(e),"=",m(t),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}var a=e?undefined:{};var r=document.cookie?document.cookie.split("; "):[];for(var s=0,c=r.length;s<c;s++){var l=r[s].split("=");var f=p(l.shift());var d=l.join("=");if(e&&e===f){a=w(d,t);break}if(!e&&(d=w(d))!==undefined){a[f]=d}}return a};g.defaults={};h.removeCookie=function(e,t){if(h.cookie(e)===undefined){return false}h.cookie(e,"",h.extend({},t,{expires:-1}));return!h.cookie(e)}});var log=function(e){console&&console.log&&console.log(e)};var tplEngine=function(e,t){var i=/<%([^%>]+)?%>/g,o=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,n="var r=[];\n",a=0;var r=function(e,t){t?n+=e.match(o)?e+"\n":"r.push("+e+");\n":n+=e!=""?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"";return r};while(match=i.exec(e)){r(e.slice(a,match.index))(match[1],true);a=match.index+match[0].length}r(e.substr(a,e.length-a));n+='return r.join("");';return new Function(n.replace(/[\r\t\n]/g,"")).apply(t)};var isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}};var operation={init:function(){var e=this;this.forceShowLazyloadImages();this.wechat();this.fontChange();this.toTop();this.share();this.footerNav();this.bind();this.tips();this.insertWeibo()},forceShowLazyloadImages:function(){if(this._forceShowImageTimer)clearTimeout(this._forceShowImageTimer);this._forceShowImageTimer=setTimeout(()=>{document.querySelectorAll(".post-content img[data-original]").forEach(function(e){const t=e.getAttribute("src");if(t&&t.indexOf("//img.alicdn.com/tfs/TB1oyqGa_tYBeNjy1XdXXXXyVXa-300-300.png")>-1){const i=e.getAttribute("data-original");console.log("Load Image: %s",i);e.setAttribute("src",i)}})},1e4)},runMusic:function(){var t=$(".post-content .music");if(!params["share"]&&!isMobile.any()&&t.size()&&window.NM){var e=t.attr("data-id");e&&NM.start(+e,function(){$("#nmPlayer").css({position:"static",margin:"40px auto",width:"80%",cursor:"default"}).off();var e=t.attr("data-index");e&&window._ap.setMusic(+e);t.append($("#nmPlayer")).show();window._ap.play()})}},initSearch:function(){if($(".local-search").size()&&!isMobile.any()){$(window).on("load",function(){$.getScript("https://fastly.jsdelivr.net/gh/barretlee/blog@gh-pages/public/js/search.js",function(){searchFunc("/search.xml","local-search-input","local-search-result")})})}},wechat:function(){var e=/MicroMessenger/i.test(navigator.userAgent);var t=$(".article .post-content");if(!t.length||!e||$(".wechat-info").size()||window._showWeChatBox)return;window._showWeChatBox=true;var i=[];$(".post img").each(function(){var e=$(this).attr("data-original")||$(this).attr("src");if(e&&/^\//.test(e))e=window.location.origin+e;i.push()});$.getScript("https://fastly.jsdelivr.net/gh/barretlee/blog@gh-pages/public/js/wechat.js",function(){wechat("network",function(e){var t=e.err_msg.split(":")[1];t=t=="wifi"?"wifi":t=="wwan"?"3g":"4g";$(".wechat-net").text(t)});$(".wechat-email").on("click",function(){var e={app:"",img:function(){var e=$(".post-content img");return e.length>2?e.eq(1).attr("src"):""},link:window.location.href,desc:"文章链接地址：",title:$(".post-title").text()};wechat("email",e,function(){})});$(".post img").on("click",function(){var e=$(this).attr("data-original")||$(this).attr("src");if(e&&/^\//.test(e))e=window.location.origin+e;wechat("imagePreview",{current:e,urls:i})});var e={debug:false,app:"wxddd17adddf433070",img:"https://www.barretlee.com/blogimgs/avatar150.png",link:window.location.href,desc:$(".post-content").text().slice(0,140),title:$(".post-title").text()};var t=function(){};wechat("friend",e,t);wechat("timeline",e,t);wechat("weibo",e,t)})},insertWeibo:function(){var e='<iframe width="330" height="350" class="share_self"  frameborder="0" scrolling="no" src="https://widget.weibo.com/weiboshow/index.php?language=&width=330&height=350&fansRow=1&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=1&isFans=0&uid=1812166904&verifier=73dc4ca5&dpc=1"></iframe>';if(/\/entry\//.test(window.location.href)&&!isMobile.any()&&$(window).width()>992&&!$(".rightbar-frame iframe").size()){var t=$(".rightbar-frame");if(!t.find("iframe").size()){$(window).on("load",function(){t.css("background","none").append(e)})}}if(isMobile.any()){$(".rightbar-frame").remove()}},alertMsg:function(e,t){if(!e)return;if(t&&"Notification"in window){notify(e);return}var i=$(".alertInfo").size()?$(".alertInfo"):$("<div class='alertInfo'></div>").appendTo($("body"));i=$(i);i.html(e).css("right","-9999").animate({right:20},800);clearTimeout(window._alert_timer);window._alert_timer=setTimeout(function(){i.animate({right:-9999},800)},3e3)},tips:function(){var e=['<div class="arrow-tips">',"  <h5>小建议: </h5>",'  <span class="close">x</span>',"  <ul>","    <li><code>shift+alt+↑</code>: 回到顶部</li>","    <li><code>shift+alt+↓</code>: 去评论</li>","    <li><code>shift+alt+←</code>: 上一篇</li>","    <li><code>shift+alt+→</code>: 下一篇</li>","  </ul>","</div>"].join("\n");if(isMobile.any()||$.cookie("tips_readed")||$(".post-title").size()==0)return;$("body").append(e);$(document).on("click",".arrow-tips .close",function(){$.cookie("tips_readed",true,{expires:8,path:"/"});$(".arrow-tips").remove()})},bind:function(){var a=this;$(".notice .close").on("click",function(e){e.preventDefault();$(".notice").removeClass("notice")});var e=window.location.hash;if(e&&$(e).size()){$("body").animate({scrollTop:$(e).offset().top})}var t=$(".footer-nav a").eq(1);!t.attr("id")&&t.trigger("click");$(window).on("load",function(){var e=window.location.hash;if(e&&e==="#comments"){$(".hash-to-comments").trigger("click")}});$(".to-comments").on("click",function(e){e.preventDefault();$(".hash-to-comments").trigger("click")});$(".hash-to-comments").on("click",function(e){e.preventDefault();var t=$(".footer-nav a").eq(0);!t.attr("id")&&t.trigger("click");if(/#comments/.test(window.location.href)){window.location.href=window.location.href}else{window.location.hash="#comments"}});if($(".local-search-google").size()){var i=$(".local-search-google input");$(".local-search-google i").on("click",function(){var e=$.trim(i.val());if(e){window.open("//www.google.com.hk/search?q=site:www.barretlee.com "+e)}})}$(window).on("resize",function(){a.insertWeibo()});$(window).on("keydown",function(e){if(e.shiftKey&&e.altKey){if(e.keyCode==39){var t=$(".page-relative-fixed .next").attr("href");if(t){window.location.href=t}else{a.alertMsg("已经是最后一篇文章了~")}}if(e.keyCode==37){var t=$(".page-relative-fixed .prev").attr("href");if(t){window.location.href=t}else{a.alertMsg("已经是第一篇文章了~")}}if(e.keyCode==38){window.scrollTo(0,0)}var i=$(".footer-nav a").eq(0);!i.attr("id")&&i.trigger("click");if(e.keyCode==40){if(/#comments/.test(window.location.href)){window.location.href=window.location.href}else{window.location.hash="#comments"}}$.cookie("tips_readed",true,{expires:8,path:"/"});if(e.keyCode===79&&/blog\/(\d+\/){3}/.test(window.location.pathname)){var o=window.location.pathname.slice(6,-1).replace(/\//g,"-")+".md";var n="https://github.com/barretlee/blog/edit/master/blog/src/_posts/"+o;window.open(n)}}})},isIE:function(e){var t=navigator.appVersion.toUpperCase();return e?t.match(/MSIE (\d)/)&&t.match(/MSIE (\d)/)[1]==e:/MSIE (\d)/.test(t)},footerNav:function(){$(".footer-nav a").on("click",function(e){e.preventDefault();var t=$(this).index();$(".footer-nav a").removeAttr("id");$(this).attr("id","comments");$(".nav-detail>div").hide().eq(t).fadeIn()});$(".relative-to-comment").on("click",function(){$(".footer-nav a").eq(0).trigger("click")})},share:function(t){var i=location.href,t=$(".post-title").text()&&"文章《"+weiboName+" "+$(".post-title").text()+"》";if(!t)t+="好站分享 "+weiboName+" ";try{t+=$("meta[property='og:description']").attr("content").slice(0,95)}catch(e){}$("#share-weibo").off().on("click",function(){var e="http://service.weibo.com/share/share.php?appkey=1812166904&title="+t+"&url="+i+"&searchPic=false&style=simple";operation._shareWin(e)});$("#share-tencent").off().on("click",function(){var e="http://share.v.t.qq.com/index.php?c=share&a=index&url="+i+"&title="+t;operation._shareWin(e)});$("#share-twitter").off().on("click",function(){var e="http://twitter.com/share?url="+i+"&text="+t+"&related=barret_china";operation._shareWin(e)});$("#share-douban").off().on("click",function(){var e="http://www.douban.com/recommend/?url="+i+"&title="+t+"&v=1";operation._shareWin(e)})},_shareWin:function(e){var t=document;var i=function(){if(!window.open(e,"share","toolbar=0,status=0,resizable=1,scrollbars=yes,status=1,width=440,height=430,left="+(screen.width-440)/2+",top="+(screen.height-430)/2))return};if(/Firefox/.test(navigator.userAgent)){setTimeout(i,0)}else{i()}},toTop:function(){var e=$(".gotop");$(window).on("scroll",function(){if($(window).scrollTop()>=$(window).height()){e.css("display","block").fadeIn()}else{e.fadeOut()}});e.on("click",function(e){var t=$("body,html");t.animate({scrollTop:0},240);e.preventDefault()})},fontChange:function(){$(".font-type").on("click",function(){$(this).parent().find("a").toggleClass("font-type-song").toggleClass("font-type-hei");$("body").toggleClass("post-font-song")});$(".bg-type").on("click",function(){$(this).parent().find("a").toggleClass("font-type-song").toggleClass("font-type-hei");$("body").toggleClass("body-bg-moon")})}};var decoration={init:function(){this.initNav();this.consoleCtt();this.menuIndex($(".post"));this.navTurner();this.sidebarNav()},initNav:function(){var i=this;var e=$(".arrow-expend");if(!e.length||!e.find("li").length)return;var o=e.find("ul");e.show().on("mouseenter",function(){clearTimeout(i.arrowTimer);o.slideDown(300)}).on("click",function(e){clearTimeout(i.arrowTimer);e.stopPropagation();o.slideToggle(300)});$("body").on("click touchstart",function(e){clearTimeout(i.arrowTimer);var t=$(e.target);if(t.hasClass("arrow-expend")||t.parent(".arrow-expend").length){}else{i.arrowTimer=setTimeout(function(){o.slideUp(300)},300)}});if(!$(".container .article").length)return;if(window.innerHeight<=550){o.slideUp(300)}$(window).on("resize",function(){clearTimeout(i.arrowTimer);if(window.innerHeight>550){o.slideDown(300)}else{o.slideUp(300)}})},consoleCtt:function(){if(window.console&&window.console.log&&!window.consoled){window.consoled=true;console.log("\n欢迎踩点小胡子哥的博客，在这里与你一起分享生活，分享技术。%c\n\n联系方式: http://barretlee.com/about/","color:red")}},sidebarNav:function(){var e=48;if(operation.isIE()){e=90}$(".sidebar").mouseenter(function(){$(this).addClass("sidebar-hover")}).mouseleave(function(){$(this).removeClass("sidebar-hover")});$(".func-item").mouseenter(function(){$(this).children("div").css({left:e,opacity:"0",display:"block"}).clearQueue().show().stop().animate({left:e-15,opacity:"1"},"fast")}).mouseleave(function(){$(this).children("div").stop().delay().animate({left:e,opacity:"0"},"fast",function(){$(this).hide()})})},menuIndex:function(e){if($("h3",e).length>2&&!isMobile.any()){var n=[],a=[],t="<ul>",r=0;$.each($("h3,h4",e),function(e,t){if(t.tagName.toLowerCase()=="h3"){var i={};i.name=$(t).text();i.id="menuIndex"+e;n.push(i);r++}else{var o={};o.name=$(t).text();o.id="menuIndex"+e;if(!a[r-1]){a[r-1]=[]}a[r-1].push(o)}t.id="menuIndex"+e});t+='<li class="h1"><a href="#" data-top="0">'+$("h1").text()+"</a></li>";for(var i=0;i<n.length;i++){t+='<li><a href="#" data-id="'+n[i].id+'">'+n[i].name+"</a></li>";if(a[i]){for(var o=0;o<a[i].length;o++){t+='<li class="h4"><a href="#" data-id="'+a[i][o].id+'">'+a[i][o].name+"</a></li>"}}}t+="</ul>";$("body").append('<div id="menuIndex"></div>');$("#menuIndex").append($(t)).delegate("a","click",function(e){e.preventDefault();var t=$(this).attr("data-top")||$("#"+$(this).attr("data-id")).offset().top;$("body, html").animate({scrollTop:t-30},400,"swing")});$(window).load(function(){var n=[];$.each($("#menuIndex li a"),function(e,t){if(!$(t).attr("data-top")){var i=$("#"+$(t).attr("data-id")).offset().top;n.push(i);$(t).attr("data-top",i)}});var e=function(){var o={};return function(e,t,i){if(!i){i="Don't call this twice without a uniqueId"}if(o[i]){clearTimeout(o[i])}o[i]=setTimeout(e,t)}}();$(window).scroll(function(){e(function(){var e=$(window).scrollTop(),t,i=n.length;if(e+60>n[i-1]){t=i}else{for(var o=0;o<i;o++){if(e+60<=n[o]){t=o;break}}}$("#menuIndex li").removeClass("on");$("#menuIndex li").eq(t).addClass("on")})})});$("#menuIndex").css("max-height",$(window).height()-80)}},navTurner:function(){if($("#menuIndex a").size()<3){$(".func-nav").parent().find("a").text("回到首页").parents(".func-item").off().on("click",function(){window.location.href="/"});$(".func-nav span").text("首页")}else{$(".func-nav").parent().on("click",function(){$("#menuIndex").slideToggle();var e=$(this).find("a").text()=="显示目录"?"隐藏目录":"显示目录";$(this).find("a").text(e)})}},refreshComments:function(){var i={};$(".ds-comment-body p").each(function(){var e=$(this).text();if(new RegExp("\\/_p(\\d+)_t(\\d)").test(e)){if(i[RegExp.$1]){i[RegExp.$1]++}else{i[RegExp.$1]=1}}});$(".post-content>p").each(function(e){if(i[e]){var t=$(this).find(".a-comments");if(!t.attr("data-num")){t.attr("data-num",i[e]).addClass("a-comments_on")}}})}};$(function(){operation.init();decoration.init();$(".highlight").parent(".highlight").removeClass("highlight");$("code").removeClass("highlight").each(function(){var e=$(this).parent(".highlight");var t=$(this).parent("pre");if(!e.size()&&t.size()){t.wrap("<div class='highlight'></div>")}})});window.alert=function(){};$(window).on("load",function(){var e=$("#followMeOnWeibo");if(e.size()>0&&!e.attr("loaded")){e.parent().on("mouseenter",function(){e.parent().off();e.attr("loaded",1);$("html").attr("xmlns:wb","http://open.weibo.com/wb");$("head").append('<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"><\/script>');$("#followMeOnWeibo").html('<wb:follow-button uid="1812166904" type="red_1" width="67" height="24" style="vertical-align:middle;display:inline-block" ></wb:follow-button>')})}});$(function(){var o=$("<div/>").css({position:"fixed",left:0,right:0,top:0,bottom:0,height:"100%",width:"100%",zIndex:9,background:"#000",opacity:"0.6",display:"none"}).attr("data-id","b_layer");var n=function(e){var t=e.offset().left;var i=e.offset().top-$(window).scrollTop();var o=e.width();var n=e.height();return e.clone().css({position:"fixed",width:o,height:n,left:t,top:i,zIndex:10})};var a=function(i){var o=$(window).width();var n=$(window).height();i.css("cursor","move").attr("data-b-img",1);var e=new Image;e.onload=function(){var e=this.width>=o-18?o-18:this.width;var t=this.height/this.width*e;i.stop().animate({width:e,height:t,left:(o-e)/2,top:(n-t)/2},300)};e.src=i.attr("src")};$(".post-content img, .pay img, .site-avatar img, .follow-wechat img, .about-wechart").css("cursor","zoom-in").off().on("click",function(e){if(isMobile.any()){return}e.preventDefault();e.stopPropagation();var t=$("body");o.appendTo(t);o.fadeIn(300);var i=n($(this));i.appendTo(t);a(i)}).each(function(){});var t=null;$(window).on("resize",function(){$("img[data-b-img]").each(function(){var e=$(this);t&&clearTimeout(t);t=setTimeout(function(){a(e)},10)})});var i=$("body");var r=false;i.on("mousedown touchstart","img[data-b-img]",function(e){e.stopImmediatePropagation();var o=$(e.target);var n=e.pageX;var a=e.pageY;o.prop("draggable",false);i.on("mousemove touchmove",function(e){e.stopImmediatePropagation();r=true;var t=e.pageX-n;var i=e.pageY-a;n=e.pageX;a=e.pageY;o.css({left:"+="+t,top:"+="+i})});i.on("mouseup mouseleave touchend touchcancel",function(e){e.stopImmediatePropagation();setTimeout(function(){r=false},300);o.removeProp("draggable");i.off("mousemove mouseup mouseleave touchmove touchend touchcancel")})});$(window).on("click keydown touchstart",function(e){if(r)return;if(e.type=="keydown"&&e.keyCode===27){o.fadeOut(300);$("img[data-b-img]").remove()}var t=$(e.target);if(t.attr("data-id")=="b_layer"||t.attr("data-b-img")==1){o.fadeOut(300);$("img[data-b-img]").remove()}else if($("img[data-b-img]").size()){o.fadeOut(300);$("img[data-b-img]").remove()}})});(function(){function i(e){return e[Math.floor(Math.random()*e.length)]}var e;function r(){if(!e){e=$("<div>").attr("id","flyzone").prependTo(document.body)}return e}var o=["smaller","small","medium","large","fat"];var s={smaller:40,small:70,medium:90,large:120,fat:200};function c(e){var t=Math.random();while(t<e){t=Math.random()}return t}function n(e,t){var i=s[e];var o=Math.floor((r().height()-i)*Math.random());var n=$("<img>").addClass("larry size-"+e).attr("src","https://img.alicdn.com/imgextra/i3/O1CN01tDYnfz23AWT1ag79p_!!6000000007215-2-tps-1200-1200.png").attr({tabindex:"0","aria-hidden":"true"}).attr("width",i).attr("height",i).css({position:"absolute",opacity:c(.4),top:o,left:-i+15});n.prependTo(r());var a=r().width()+i;n.animate({left:a},t,function(){n.remove();l()});return n}function l(){var e=i(o);var t=Math.floor(Math.random()*2e4)+15e3;return n(e,t)}$(function(){$("#indexLogo").click(function(){l()});$(".home-box h2 a").click(function(e){e.preventDefault();l();return false})});var t=/\blarry(=(\d+))?\b/i.exec(window.location.search);if(t){var a=parseInt(t[2])||20;$(function(){for(var e=0;e<a;++e){setTimeout(l,Math.random()*a*500)}})}})();